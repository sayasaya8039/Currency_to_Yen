(()=>{"use strict";const t={$:"USD","â‚¬":"EUR","Â£":"GBP","â‚©":"KRW",US$:"USD",HK$:"HKD",AU$:"AUD",A$:"AUD",CA$:"CAD",C$:"CAD",SG$:"SGD",S$:"SGD",NT$:"TWD","à¸¿":"THB","â‚¹":"INR","â‚±":"PHP",RM:"MYR",CHF:"CHF"};function e(t){let e=t.trim();e=e.replace(/,/g,"");const n=parseFloat(e);return isNaN(n)||n<=0||n>1e9?0:n}const n=[{pattern:/(?:US|HK|AU|CA|SG|NT|A|C|S)\$\s*([\d,]{1,15}(?:\.\d{1,2})?)\b/gi,getCode:t=>{const e=t[0].match(/^(US|HK|AU|CA|SG|NT|A|C|S)\$/i)?.[1]?.toUpperCase();return{US:"USD",HK:"HKD",AU:"AUD",A:"AUD",CA:"CAD",C:"CAD",SG:"SGD",S:"SGD",NT:"TWD"}[e||""]||null},getAmount:t=>e(t[1])},{pattern:/([$â‚¬Â£â‚©â‚¹â‚±à¸¿])\s*([\d,]{1,15}(?:\.\d{1,2})?)\b/g,getCode:e=>t[e[1]]||null,getAmount:t=>e(t[2])},{pattern:/\b([\d,]{1,15}(?:\.\d{1,2})?)\s*(USD|EUR|GBP|CNY|KRW|AUD|CAD|CHF|HKD|SGD|TWD|THB|INR|PHP|MYR)\b/gi,getCode:t=>t[2].toUpperCase(),getAmount:t=>e(t[1])},{pattern:/\b(USD|EUR|GBP|CNY|KRW|AUD|CAD|CHF|HKD|SGD|TWD|THB|INR|PHP|MYR)\s*([\d,]{1,15}(?:\.\d{1,2})?)\b/gi,getCode:t=>t[1].toUpperCase(),getAmount:t=>e(t[2])},{pattern:/RM\s*([\d,]{1,15}(?:\.\d{1,2})?)\b/gi,getCode:()=>"MYR",getAmount:t=>e(t[1])},{pattern:/CHF\s*([\d,]{1,15}(?:\.\d{1,2})?)\b/gi,getCode:()=>"CHF",getAmount:t=>e(t[1])}];function o(t){const e=[],o=[];for(const{pattern:i,getCode:r,getAmount:c}of n){let n;for(i.lastIndex=0;null!==(n=i.exec(t));){const t=r(n),i=c(n);if(!t||i<=0)continue;if("JPY"===t)continue;const s=n.index,l=n.index+n[0].length;o.some(t=>s>=t.start&&s<t.end||l>t.start&&l<=t.end||s<=t.start&&l>=t.end)||(e.push({code:t,amount:i,originalText:n[0],startIndex:s,endIndex:l}),o.push({start:s,end:l}))}}return e.sort((t,e)=>t.startIndex-e.startIndex)}function i(t,e,n){const i=t.tagName?.toLowerCase();if(["script","style","input","textarea","select","body","html","head"].includes(i))return null;const r=i.includes("-")||"number-flow-react"===i;let c=t.textContent?.trim()||"";if(!c&&r&&(c=t.innerText?.trim()||""),!c||c.length<2){const e=t.getAttribute("aria-label");e&&(c=e.trim())}if(!c||c.length<2){const e=t.getAttribute("title");e&&(c=e.trim())}if(!c||c.length<2){const e=t.getAttribute("data-value")||t.getAttribute("data-amount")||t.getAttribute("data-price");e&&(c=e.trim())}const s=r?100:50;if(c.length<1||c.length>s)return null;const l=t.getBoundingClientRect(),a=r?200:150;if(l.width>a||l.height>60)return null;if(!(e>=l.left-5&&e<=l.right+5&&n>=l.top-5&&n<=l.bottom+5))return null;const u=o(c);return u.length>0?u[0]:null}function r(t,e,n,o,i){try{const r=document.createRange();r.setStart(t,e),r.setEnd(t,n);const c=r.getBoundingClientRect(),s=5;return o>=c.left-s&&o<=c.right+s&&i>=c.top-s&&i<=c.bottom+s}catch{return!1}}const c={USD:"ç±³ãƒ‰ãƒ«",EUR:"ãƒ¦ãƒ¼ãƒ­",GBP:"è‹±ãƒãƒ³ãƒ‰",CNY:"ä¸­å›½å…ƒ",KRW:"éŸ“å›½ã‚¦ã‚©ãƒ³",AUD:"è±ªãƒ‰ãƒ«",CAD:"ã‚«ãƒŠãƒ€ãƒ‰ãƒ«",CHF:"ã‚¹ã‚¤ã‚¹ãƒ•ãƒ©ãƒ³",HKD:"é¦™æ¸¯ãƒ‰ãƒ«",SGD:"ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ãƒ‰ãƒ«",TWD:"å°æ¹¾ãƒ‰ãƒ«",THB:"ã‚¿ã‚¤ãƒãƒ¼ãƒ„",INR:"ã‚¤ãƒ³ãƒ‰ãƒ«ãƒ”ãƒ¼",PHP:"ãƒ•ã‚£ãƒªãƒ”ãƒ³ãƒšã‚½",MYR:"ãƒžãƒ¬ãƒ¼ã‚·ã‚¢ãƒªãƒ³ã‚®ãƒƒãƒˆ",JPY:"æ—¥æœ¬å††"},s="currency-to-yen-tooltip";let l=null,a=null,u=null;function d(t){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",maximumFractionDigits:0}).format(Math.round(t))}async function y(t,e,n){a&&(clearTimeout(a),a=null),u&&(clearTimeout(u),u=null),a=window.setTimeout(async()=>{try{let o;try{o=await chrome.runtime.sendMessage({type:"CONVERT_TO_YEN",amount:t.amount,currency:t.code})}catch{return}if(!o||!o.success)return;const{yen:i,rate:r,date:a}=o.data,u=(l&&document.body.contains(l)||(l=function(){const t=document.createElement("div");return t.id=s,t.className="cty-tooltip",t.innerHTML='\n    <div class="cty-tooltip-arrow"></div>\n    <div class="cty-tooltip-content">\n      <div class="cty-tooltip-header">\n        <span class="cty-currency-icon">ðŸ’´</span>\n        <span class="cty-original"></span>\n      </div>\n      <div class="cty-tooltip-body">\n        <span class="cty-converted"></span>\n      </div>\n      <div class="cty-tooltip-footer">\n        <span class="cty-rate-info"></span>\n      </div>\n    </div>\n  ',t.style.display="none",document.body.appendChild(t),t}()),l),y=u.querySelector(".cty-original"),m=u.querySelector(".cty-converted"),g=u.querySelector(".cty-rate-info");y&&(y.textContent=t.originalText),m&&(m.textContent=d(i)),g&&(g.textContent=`${function(t,e){return`1 ${e}ï¼ˆ${c[e]||e}ï¼‰= ${d(t)}`}(r,t.code)}ï¼ˆ${a}ï¼‰`),function(t,e,n){const o=10;t.style.visibility="hidden",t.style.display="block";const i=t.getBoundingClientRect(),r=window.innerWidth,c=window.innerHeight;let s=e-i.width/2,l=n-i.height-8-o,a="bottom";l<o&&(l=n+8+o,a="top"),s<o&&(s=o),s+i.width>r-o&&(s=r-i.width-o),l+i.height>c-o&&(l=c-i.height-o),t.style.left=`${s}px`,t.style.top=`${l}px`,t.style.visibility="visible";const u=t.querySelector(".cty-tooltip-arrow");if(u){u.classList.remove("cty-arrow-top","cty-arrow-bottom"),u.classList.add(`cty-arrow-${a}`);const t=Math.max(20,Math.min(e-s,i.width-20));u.style.left=`${t}px`}}(u,e,n),u.style.display="block",u.classList.add("cty-tooltip-visible")}catch{}},200)}function m(){a&&(clearTimeout(a),a=null),u=window.setTimeout(()=>{const t=document.getElementById(s);t&&(t.classList.remove("cty-tooltip-visible"),t.style.display="none"),u=null},100)}function g(){u&&(clearTimeout(u),u=null)}let f=!0,p=null,h=null;function C(t){f&&(h&&clearTimeout(h),h=window.setTimeout(()=>{!function(t){const e=t.target;if(e.closest("#currency-to-yen-tooltip"))return void g();const n=function(t,e,n){const c=function(t,e){try{const n=document.caretRangeFromPoint(t,e);if(!n)return null;const i=n.startContainer;if(i.nodeType!==Node.TEXT_NODE)return null;const c=i.textContent||"",s=n.startOffset,l=Math.max(0,s-50),a=Math.min(c.length,s+50),u=o(c.substring(l,a)),d=s-l;for(const n of u)if(d>=n.startIndex&&d<=n.endIndex){const o=n.startIndex+l,c=n.endIndex+l;if(r(i,o,c,t,e))return{...n,startIndex:o,endIndex:c}}}catch{}return null}(e,n);if(c)return c;const s=i(t,e,n);if(s)return s;return function(t,e,n){let o=t.parentElement,r=0;for(;o&&r<15;){const t=o.tagName?.toLowerCase();if(["body","html","head"].includes(t))break;if(t.includes("-")){const t=i(o,e,n);if(t)return t}const c=i(o,e,n);if(c)return c;o=o.parentElement,r++}return null}(t,e,n)||null}(e,t.clientX,t.clientY);if(n){if(p&&p.originalText===n.originalText&&p.startIndex===n.startIndex)return void g();p=n,y(n,t.clientX,t.clientY)}else p&&(p=null,m())}(t),h=null},50))}function D(t){const e=t.relatedTarget;e?.closest?.("#currency-to-yen-tooltip")||e&&document.body.contains(e)||(p=null,m())}function b(){document.addEventListener("mousemove",C,{passive:!0}),document.addEventListener("mouseout",D,{passive:!0}),document.addEventListener("scroll",()=>{p=null,m()},{passive:!0}),window.addEventListener("beforeunload",()=>{l&&(l.remove(),l=null),a&&(clearTimeout(a),a=null),u&&(clearTimeout(u),u=null)})}(async function(){try{await async function(){try{const t=await chrome.runtime.sendMessage({type:"GET_SETTINGS"});if(t.success){const e=t.data;f=e.enabled,console.log("[Currency to Yen] è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:",e)}}catch(t){console.warn("[Currency to Yen] è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:",t)}}()}catch{f=!0}try{chrome.storage.onChanged.addListener((t,e)=>{if("sync"===e&&t.settings){const e=t.settings.newValue;f=e.enabled,console.log("[Currency to Yen] è¨­å®šãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ:",e),f||m()}})}catch{}b()})().catch(()=>{b()})})();
//# sourceMappingURL=index.js.map