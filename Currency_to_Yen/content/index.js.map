{"version":3,"file":"content/index.js","mappings":"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","sources":["webpack://currency-to-yen/./src/content/currencyDetector.ts","webpack://currency-to-yen/./src/types/currency.ts","webpack://currency-to-yen/./src/content/tooltip.ts","webpack://currency-to-yen/./src/content/index.ts"],"sourcesContent":["/**\n * é€šè²¨æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯\n * ãƒ†ã‚­ã‚¹ãƒˆå†…ã®é€šè²¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã—ã€DetectedCurrency ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™\n */\n\nimport type { CurrencyCode, DetectedCurrency } from '../types/currency';\n\n/** é€šè²¨ã‚·ãƒ³ãƒœãƒ«ã‹ã‚‰é€šè²¨ã‚³ãƒ¼ãƒ‰ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚° */\nconst SYMBOL_TO_CODE: Record<string, CurrencyCode> = {\n  $: 'USD',\n  'â‚¬': 'EUR',\n  'Â£': 'GBP',\n  'â‚©': 'KRW',\n  'US$': 'USD',\n  'HK$': 'HKD',\n  'AU$': 'AUD',\n  'A$': 'AUD',\n  'CA$': 'CAD',\n  'C$': 'CAD',\n  'SG$': 'SGD',\n  'S$': 'SGD',\n  'NT$': 'TWD',\n  'à¸¿': 'THB',\n  'â‚¹': 'INR',\n  'â‚±': 'PHP',\n  'RM': 'MYR',\n  'CHF': 'CHF',\n};\n\n/** æœ€å¤§é‡‘é¡ï¼ˆ10å„„ï¼‰- ã“ã‚Œã‚’è¶…ãˆã‚‹é‡‘é¡ã¯ç„¡è¦– */\nconst MAX_AMOUNT = 1_000_000_000;\n\n/**\n * æ•°å€¤æ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦æ•°å€¤ã«å¤‰æ›\n * ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€ãƒ”ãƒªã‚ªãƒ‰åŒºåˆ‡ã‚Šã«å¯¾å¿œ\n */\nfunction parseAmount(amountStr: string): number {\n  // ç©ºç™½ã‚’å‰Šé™¤\n  let cleaned = amountStr.trim();\n\n  // ã‚«ãƒ³ãƒã‚’å‰Šé™¤ï¼ˆæ¡åŒºåˆ‡ã‚Šï¼‰\n  cleaned = cleaned.replace(/,/g, '');\n\n  // æ•°å€¤ã«å¤‰æ›\n  const amount = parseFloat(cleaned);\n\n  // ç•°å¸¸ãªé‡‘é¡ã¯é™¤å¤–\n  if (isNaN(amount) || amount <= 0 || amount > MAX_AMOUNT) {\n    return 0;\n  }\n\n  return amount;\n}\n\n/**\n * é€šè²¨æ¤œå‡ºç”¨ã®æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³\n * æ³¨: æ•°å­—ã¯æœ€å¤§12æ¡ã¾ã§ï¼ˆå…†å˜ä½ï¼‰ã«åˆ¶é™\n */\nconst CURRENCY_PATTERNS: Array<{\n  pattern: RegExp;\n  getCode: (match: RegExpMatchArray) => CurrencyCode | null;\n  getAmount: (match: RegExpMatchArray) => number;\n}> = [\n  // US$100, HK$100, AU$100, CA$100, SG$100, NT$100, A$100, C$100, S$100\n  {\n    pattern: /(?:US|HK|AU|CA|SG|NT|A|C|S)\\$\\s*([\\d,]{1,15}(?:\\.\\d{1,2})?)\\b/gi,\n    getCode: (match) => {\n      const prefix = match[0].match(/^(US|HK|AU|CA|SG|NT|A|C|S)\\$/i)?.[1]?.toUpperCase();\n      const mapping: Record<string, CurrencyCode> = {\n        US: 'USD', HK: 'HKD', AU: 'AUD', A: 'AUD',\n        CA: 'CAD', C: 'CAD', SG: 'SGD', S: 'SGD', NT: 'TWD',\n      };\n      return mapping[prefix || ''] || null;\n    },\n    getAmount: (match) => parseAmount(match[1]),\n  },\n\n  // $100, â‚¬100, Â£100, â‚©100ï¼ˆæ•°å­—ã¯æœ€å¤§12æ¡ï¼‰\n  {\n    pattern: /([$â‚¬Â£â‚©â‚¹â‚±à¸¿])\\s*([\\d,]{1,15}(?:\\.\\d{1,2})?)\\b/g,\n    getCode: (match) => SYMBOL_TO_CODE[match[1]] || null,\n    getAmount: (match) => parseAmount(match[2]),\n  },\n\n  // 100 USD, 100 EUR, 100 GBP ãªã©ï¼ˆé€šè²¨ã‚³ãƒ¼ãƒ‰å¾Œç½®ï¼‰\n  {\n    pattern: /\\b([\\d,]{1,15}(?:\\.\\d{1,2})?)\\s*(USD|EUR|GBP|CNY|KRW|AUD|CAD|CHF|HKD|SGD|TWD|THB|INR|PHP|MYR)\\b/gi,\n    getCode: (match) => match[2].toUpperCase() as CurrencyCode,\n    getAmount: (match) => parseAmount(match[1]),\n  },\n\n  // USD 100, EUR 100 ãªã©ï¼ˆé€šè²¨ã‚³ãƒ¼ãƒ‰å‰ç½®ï¼‰\n  {\n    pattern: /\\b(USD|EUR|GBP|CNY|KRW|AUD|CAD|CHF|HKD|SGD|TWD|THB|INR|PHP|MYR)\\s*([\\d,]{1,15}(?:\\.\\d{1,2})?)\\b/gi,\n    getCode: (match) => match[1].toUpperCase() as CurrencyCode,\n    getAmount: (match) => parseAmount(match[2]),\n  },\n\n  // RM100ï¼ˆãƒãƒ¬ãƒ¼ã‚·ã‚¢ãƒªãƒ³ã‚®ãƒƒãƒˆï¼‰\n  {\n    pattern: /RM\\s*([\\d,]{1,15}(?:\\.\\d{1,2})?)\\b/gi,\n    getCode: () => 'MYR',\n    getAmount: (match) => parseAmount(match[1]),\n  },\n\n  // CHF 100, 100 CHFï¼ˆã‚¹ã‚¤ã‚¹ãƒ•ãƒ©ãƒ³ - ç‰¹åˆ¥å¯¾å¿œï¼‰\n  {\n    pattern: /CHF\\s*([\\d,]{1,15}(?:\\.\\d{1,2})?)\\b/gi,\n    getCode: () => 'CHF',\n    getAmount: (match) => parseAmount(match[1]),\n  },\n];\n\n/**\n * ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰é€šè²¨ã‚’æ¤œå‡º\n */\nexport function detectCurrencies(text: string): DetectedCurrency[] {\n  const results: DetectedCurrency[] = [];\n  const foundRanges: Array<{ start: number; end: number }> = [];\n\n  // å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒãƒƒãƒãƒ³ã‚°ã‚’å®Ÿè¡Œ\n  for (const { pattern, getCode, getAmount } of CURRENCY_PATTERNS) {\n    // ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ\n    pattern.lastIndex = 0;\n\n    let match: RegExpExecArray | null;\n    while ((match = pattern.exec(text)) !== null) {\n      const code = getCode(match);\n      const amount = getAmount(match);\n\n      if (!code || amount <= 0) continue;\n\n      // æ—¥æœ¬å††ã¯é™¤å¤–\n      if (code === 'JPY') continue;\n\n      const startIndex = match.index;\n      const endIndex = match.index + match[0].length;\n\n      // æ—¢ã«æ¤œå‡ºã•ã‚ŒãŸç¯„å›²ã¨é‡è¤‡ã—ã¦ã„ãªã„ã‹ç¢ºèª\n      const isOverlapping = foundRanges.some(\n        (range) =>\n          (startIndex >= range.start && startIndex < range.end) ||\n          (endIndex > range.start && endIndex <= range.end) ||\n          (startIndex <= range.start && endIndex >= range.end)\n      );\n\n      if (!isOverlapping) {\n        results.push({\n          code,\n          amount,\n          originalText: match[0],\n          startIndex,\n          endIndex,\n        });\n        foundRanges.push({ start: startIndex, end: endIndex });\n      }\n    }\n  }\n\n  // é–‹å§‹ä½ç½®ã§ã‚½ãƒ¼ãƒˆ\n  return results.sort((a, b) => a.startIndex - b.startIndex);\n}\n\n/**\n * ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰é€šè²¨ã‚’æ¤œå‡º\n * caretRangeFromPoint ã‚’ä½¿ç”¨ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒå®Ÿéš›ã«é€šè²¨ãƒ†ã‚­ã‚¹ãƒˆä¸Šã«ã‚ã‚‹å ´åˆã®ã¿æ¤œå‡º\n */\nexport function detectCurrencyAtPoint(\n  element: Element,\n  x: number,\n  y: number\n): DetectedCurrency | null {\n  // æ–¹æ³•1: caretRangeFromPoint ã‚’ä½¿ç”¨ã—ã¦ç²¾å¯†ã«æ¤œå‡º\n  const rangeResult = detectFromCaretRange(x, y);\n  if (rangeResult) return rangeResult;\n\n  // æ–¹æ³•2: React/Shadow DOMå¯¾å¿œ - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦ç´ ã‹ã‚‰æ¤œå‡º\n  const elementResult = detectFromTargetElement(element, x, y);\n  if (elementResult) return elementResult;\n\n  // æ–¹æ³•3: è¦ªè¦ç´ ã‚’è¾¿ã£ã¦æ¤œå‡ºï¼ˆX/Twitterå¯¾å¿œï¼‰\n  const parentResult = detectFromParentElements(element, x, y);\n  if (parentResult) return parentResult;\n\n  return null;\n}\n\n/**\n * è¦ªè¦ç´ ã‚’è¾¿ã£ã¦é€šè²¨ã‚’æ¤œå‡ºï¼ˆX/Twitterã€Grokå¯¾å¿œï¼‰\n */\nfunction detectFromParentElements(\n  element: Element,\n  x: number,\n  y: number\n): DetectedCurrency | null {\n  let current: Element | null = element.parentElement;\n  let depth = 0;\n  const maxDepth = 15; // æ·±ã„ãƒã‚¹ãƒˆã«å¯¾å¿œ\n\n  while (current && depth < maxDepth) {\n    // body, html ã¯é™¤å¤–\n    const tagName = current.tagName?.toLowerCase();\n    if (['body', 'html', 'head'].includes(tagName)) {\n      break;\n    }\n\n    // number-flow-react ãªã©ã®ã‚«ã‚¹ã‚¿ãƒ è¦ç´ ã‚’å„ªå…ˆçš„ã«æ¤œå‡º\n    if (tagName.includes('-')) {\n      const result = detectFromTargetElement(current, x, y);\n      if (result) return result;\n    }\n\n    const result = detectFromTargetElement(current, x, y);\n    if (result) return result;\n\n    current = current.parentElement;\n    depth++;\n  }\n\n  return null;\n}\n\n/**\n * ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦ç´ ã‹ã‚‰é€šè²¨ã‚’æ¤œå‡ºï¼ˆReactã‚¢ãƒ—ãƒªå¯¾å¿œï¼‰\n * è¦ç´ ã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å†…ã«ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚Šã€ã‹ã¤çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆã®ã¿æ¤œå‡º\n */\nfunction detectFromTargetElement(\n  element: Element,\n  x: number,\n  y: number\n): DetectedCurrency | null {\n  // å…¥åŠ›è¦ç´ ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯é™¤å¤–\n  const tagName = element.tagName?.toLowerCase();\n  if (['script', 'style', 'input', 'textarea', 'select', 'body', 'html', 'head'].includes(tagName)) {\n    return null;\n  }\n\n  // ã‚«ã‚¹ã‚¿ãƒ Web Componentï¼ˆnumber-flow-reactç­‰ï¼‰ã®ç‰¹åˆ¥å‡¦ç†\n  const isCustomElement = tagName.includes('-') || tagName === 'number-flow-react';\n\n  // è¦ç´ ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—\n  let text = element.textContent?.trim() || '';\n\n  // ã‚«ã‚¹ã‚¿ãƒ è¦ç´ ã®å ´åˆã€innerTextã‚‚è©¦ã™\n  if (!text && isCustomElement) {\n    text = (element as HTMLElement).innerText?.trim() || '';\n  }\n\n  // aria-labelå±æ€§ã‹ã‚‰é€šè²¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ï¼ˆnumber-flow-reactç­‰ã§ä½¿ç”¨ï¼‰\n  if (!text || text.length < 2) {\n    const ariaLabel = element.getAttribute('aria-label');\n    if (ariaLabel) {\n      text = ariaLabel.trim();\n    }\n  }\n\n  // titleå±æ€§ã‹ã‚‰é€šè²¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ï¼ˆãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹å ´åˆï¼‰\n  if (!text || text.length < 2) {\n    const title = element.getAttribute('title');\n    if (title) {\n      text = title.trim();\n    }\n  }\n\n  // data-value, data-amountå±æ€§ã‹ã‚‰é€šè²¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ï¼ˆReactã‚¢ãƒ—ãƒªã§ä½¿ç”¨ï¼‰\n  if (!text || text.length < 2) {\n    const dataValue = element.getAttribute('data-value') ||\n                      element.getAttribute('data-amount') ||\n                      element.getAttribute('data-price');\n    if (dataValue) {\n      text = dataValue.trim();\n    }\n  }\n\n  // ãƒ†ã‚­ã‚¹ãƒˆãŒçŸ­ã„å ´åˆã®ã¿æ¤œå‡º\n  // ã‚«ã‚¹ã‚¿ãƒ è¦ç´ ã¯100æ–‡å­—ã¾ã§è¨±å¯ï¼ˆè¤‡æ•°ã®å­è¦ç´ ã‚’å«ã‚€å ´åˆãŒã‚ã‚‹ï¼‰\n  const maxLength = isCustomElement ? 100 : 50;\n  if (text.length < 1 || text.length > maxLength) {\n    return null;\n  }\n\n  // è¦ç´ ã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’ç¢ºèª\n  const rect = element.getBoundingClientRect();\n  const padding = 5;\n\n  // è¦ç´ ãŒå¤§ãã™ãã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆèª¤æ¤œå‡ºé˜²æ­¢ï¼‰\n  // é€šè²¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚€è¦ç´ ã¯é€šå¸¸å°ã•ã„\n  const maxWidth = isCustomElement ? 200 : 150;\n  const maxHeight = 60;\n  if (rect.width > maxWidth || rect.height > maxHeight) {\n    return null;\n  }\n\n  const isInBounds =\n    x >= rect.left - padding &&\n    x <= rect.right + padding &&\n    y >= rect.top - padding &&\n    y <= rect.bottom + padding;\n\n  if (!isInBounds) {\n    return null;\n  }\n\n  // é€šè²¨ã‚’æ¤œå‡º\n  const currencies = detectCurrencies(text);\n\n  return currencies.length > 0 ? currencies[0] : null;\n}\n\n/**\n * caretRangeFromPoint ã‚’ä½¿ç”¨ã—ã¦æ¤œå‡º\n * ã‚«ãƒ¼ã‚½ãƒ«ãŒé€šè²¨ãƒ†ã‚­ã‚¹ãƒˆã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å†…ã«ã‚ã‚‹ã‹ã‚‚ç¢ºèª\n */\nfunction detectFromCaretRange(x: number, y: number): DetectedCurrency | null {\n  try {\n    const range = document.caretRangeFromPoint(x, y);\n    if (!range) return null;\n\n    const textNode = range.startContainer;\n    if (textNode.nodeType !== Node.TEXT_NODE) return null;\n\n    const text = textNode.textContent || '';\n    const offset = range.startOffset;\n\n    // ã‚«ãƒ¼ã‚½ãƒ«å‘¨è¾ºã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ï¼ˆå‰å¾Œ50æ–‡å­—ï¼‰\n    const start = Math.max(0, offset - 50);\n    const end = Math.min(text.length, offset + 50);\n    const surroundingText = text.substring(start, end);\n\n    const currencies = detectCurrencies(surroundingText);\n    const relativeOffset = offset - start;\n\n    for (const currency of currencies) {\n      if (relativeOffset >= currency.startIndex && relativeOffset <= currency.endIndex) {\n        // é€šè²¨ãƒ†ã‚­ã‚¹ãƒˆã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’å–å¾—ã—ã¦ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒå®Ÿéš›ã«ãã®ä¸Šã«ã‚ã‚‹ã‹ç¢ºèª\n        const actualStart = currency.startIndex + start;\n        const actualEnd = currency.endIndex + start;\n\n        if (isPointInTextRange(textNode, actualStart, actualEnd, x, y)) {\n          return {\n            ...currency,\n            startIndex: actualStart,\n            endIndex: actualEnd,\n          };\n        }\n      }\n    }\n  } catch {\n    // caretRangeFromPoint ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å ´åˆ\n  }\n\n  return null;\n}\n\n/**\n * æŒ‡å®šã—ãŸåº§æ¨™ãŒãƒ†ã‚­ã‚¹ãƒˆç¯„å›²ã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å†…ã«ã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n */\nfunction isPointInTextRange(\n  textNode: Node,\n  startOffset: number,\n  endOffset: number,\n  x: number,\n  y: number\n): boolean {\n  try {\n    const range = document.createRange();\n    range.setStart(textNode, startOffset);\n    range.setEnd(textNode, endOffset);\n\n    const rect = range.getBoundingClientRect();\n\n    // å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹ï¼ˆ5pxï¼‰\n    const padding = 5;\n\n    return (\n      x >= rect.left - padding &&\n      x <= rect.right + padding &&\n      y >= rect.top - padding &&\n      y <= rect.bottom + padding\n    );\n  } catch {\n    return false;\n  }\n}\n\n/**\n * è¦ç´ å†…ã®é€šè²¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒ£ãƒ³\n */\nexport function scanElement(element: Element): DetectedCurrency[] {\n  const text = element.textContent || '';\n  return detectCurrencies(text);\n}\n","/**\n * é€šè²¨é–¢é€£ã®å‹å®šç¾©\n */\n\n/** ã‚µãƒãƒ¼ãƒˆã™ã‚‹é€šè²¨ã‚³ãƒ¼ãƒ‰ */\nexport type CurrencyCode =\n  | 'USD' | 'EUR' | 'GBP' | 'CNY' | 'KRW'\n  | 'AUD' | 'CAD' | 'CHF' | 'HKD' | 'SGD'\n  | 'TWD' | 'THB' | 'INR' | 'PHP' | 'MYR'\n  | 'JPY';\n\n/** é€šè²¨ã‚·ãƒ³ãƒœãƒ«æƒ…å ± */\nexport interface CurrencySymbol {\n  symbol: string;\n  code: CurrencyCode;\n  position: 'prefix' | 'suffix';\n}\n\n/** æ¤œå‡ºã•ã‚ŒãŸé€šè²¨æƒ…å ± */\nexport interface DetectedCurrency {\n  code: CurrencyCode;\n  amount: number;\n  originalText: string;\n  startIndex: number;\n  endIndex: number;\n}\n\n/** ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ */\nexport interface ExchangeRateResponse {\n  amount: number;\n  base: string;\n  date: string;\n  rates: Record<string, number>;\n}\n\n/** ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ */\nexport interface CachedRates {\n  rates: Record<CurrencyCode, number>;\n  date: string;\n  fetchedAt: number;\n}\n\n/** æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®š */\nexport interface ExtensionSettings {\n  enabled: boolean;\n  showOriginalAmount: boolean;\n  tooltipDelay: number;\n}\n\n/** ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ— */\nexport type MessageType =\n  | { type: 'GET_EXCHANGE_RATE'; currency: CurrencyCode }\n  | { type: 'GET_ALL_RATES' }\n  | { type: 'GET_SETTINGS' }\n  | { type: 'SET_SETTINGS'; settings: Partial<ExtensionSettings> };\n\n/** ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹ */\nexport interface MessageResponse<T = unknown> {\n  success: boolean;\n  data?: T;\n  error?: string;\n}\n\n/** é€šè²¨ã‚·ãƒ³ãƒœãƒ«ãƒãƒƒãƒ”ãƒ³ã‚° */\nexport const CURRENCY_SYMBOLS: CurrencySymbol[] = [\n  { symbol: '$', code: 'USD', position: 'prefix' },\n  { symbol: 'â‚¬', code: 'EUR', position: 'prefix' },\n  { symbol: 'Â£', code: 'GBP', position: 'prefix' },\n  { symbol: 'Â¥', code: 'CNY', position: 'prefix' },\n  { symbol: 'â‚©', code: 'KRW', position: 'prefix' },\n  { symbol: 'US$', code: 'USD', position: 'prefix' },\n  { symbol: 'HK$', code: 'HKD', position: 'prefix' },\n  { symbol: 'AU$', code: 'AUD', position: 'prefix' },\n  { symbol: 'CA$', code: 'CAD', position: 'prefix' },\n  { symbol: 'SG$', code: 'SGD', position: 'prefix' },\n  { symbol: 'A$', code: 'AUD', position: 'prefix' },\n  { symbol: 'C$', code: 'CAD', position: 'prefix' },\n];\n\n/** é€šè²¨ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºåï¼ˆæ—¥æœ¬èªï¼‰ */\nexport const CURRENCY_NAMES: Record<CurrencyCode, string> = {\n  USD: 'ç±³ãƒ‰ãƒ«',\n  EUR: 'ãƒ¦ãƒ¼ãƒ­',\n  GBP: 'è‹±ãƒãƒ³ãƒ‰',\n  CNY: 'ä¸­å›½å…ƒ',\n  KRW: 'éŸ“å›½ã‚¦ã‚©ãƒ³',\n  AUD: 'è±ªãƒ‰ãƒ«',\n  CAD: 'ã‚«ãƒŠãƒ€ãƒ‰ãƒ«',\n  CHF: 'ã‚¹ã‚¤ã‚¹ãƒ•ãƒ©ãƒ³',\n  HKD: 'é¦™æ¸¯ãƒ‰ãƒ«',\n  SGD: 'ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ãƒ‰ãƒ«',\n  TWD: 'å°æ¹¾ãƒ‰ãƒ«',\n  THB: 'ã‚¿ã‚¤ãƒãƒ¼ãƒ„',\n  INR: 'ã‚¤ãƒ³ãƒ‰ãƒ«ãƒ”ãƒ¼',\n  PHP: 'ãƒ•ã‚£ãƒªãƒ”ãƒ³ãƒšã‚½',\n  MYR: 'ãƒãƒ¬ãƒ¼ã‚·ã‚¢ãƒªãƒ³ã‚®ãƒƒãƒˆ',\n  JPY: 'æ—¥æœ¬å††',\n};\n\n/** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š */\nexport const DEFAULT_SETTINGS: ExtensionSettings = {\n  enabled: true,\n  showOriginalAmount: true,\n  tooltipDelay: 200,\n};\n","/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n * é€šè²¨å¤‰æ›çµæœã‚’å¯æ„›ã‚‰ã—ã„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§è¡¨ç¤º\n */\n\nimport type { CurrencyCode, DetectedCurrency } from '../types/currency';\nimport { CURRENCY_NAMES } from '../types/currency';\n\n/** ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®ID */\nconst TOOLTIP_ID = 'currency-to-yen-tooltip';\n\n/** ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´  */\nlet tooltipElement: HTMLElement | null = null;\n\n/** ç¾åœ¨ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºã‚¿ã‚¤ãƒãƒ¼ */\nlet showTimer: number | null = null;\n\n/** ç¾åœ¨ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—éè¡¨ç¤ºã‚¿ã‚¤ãƒãƒ¼ */\nlet hideTimer: number | null = null;\n\n/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ã‚’ä½œæˆ\n */\nfunction createTooltipElement(): HTMLElement {\n  const tooltip = document.createElement('div');\n  tooltip.id = TOOLTIP_ID;\n  tooltip.className = 'cty-tooltip';\n  tooltip.innerHTML = `\n    <div class=\"cty-tooltip-arrow\"></div>\n    <div class=\"cty-tooltip-content\">\n      <div class=\"cty-tooltip-header\">\n        <span class=\"cty-currency-icon\">ğŸ’´</span>\n        <span class=\"cty-original\"></span>\n      </div>\n      <div class=\"cty-tooltip-body\">\n        <span class=\"cty-converted\"></span>\n      </div>\n      <div class=\"cty-tooltip-footer\">\n        <span class=\"cty-rate-info\"></span>\n      </div>\n    </div>\n  `;\n  tooltip.style.display = 'none';\n  document.body.appendChild(tooltip);\n  return tooltip;\n}\n\n/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ã‚’å–å¾—ï¼ˆãªã‘ã‚Œã°ä½œæˆï¼‰\n */\nfunction getTooltipElement(): HTMLElement {\n  if (!tooltipElement || !document.body.contains(tooltipElement)) {\n    tooltipElement = createTooltipElement();\n  }\n  return tooltipElement;\n}\n\n/**\n * é‡‘é¡ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆæ—¥æœ¬å††ï¼‰\n */\nfunction formatYen(amount: number): string {\n  return new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: 'JPY',\n    maximumFractionDigits: 0,\n  }).format(Math.round(amount));\n}\n\n/**\n * ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\n */\nfunction formatRate(rate: number, code: CurrencyCode): string {\n  const name = CURRENCY_NAMES[code] || code;\n  return `1 ${code}ï¼ˆ${name}ï¼‰= ${formatYen(rate)}`;\n}\n\n/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¡¨ç¤º\n */\nexport async function showTooltip(\n  currency: DetectedCurrency,\n  x: number,\n  y: number\n): Promise<void> {\n  // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢\n  if (showTimer) {\n    clearTimeout(showTimer);\n    showTimer = null;\n  }\n  if (hideTimer) {\n    clearTimeout(hideTimer);\n    hideTimer = null;\n  }\n\n  // é…å»¶è¡¨ç¤ºï¼ˆ200msï¼‰\n  showTimer = window.setTimeout(async () => {\n    try {\n      // Service Worker ã«å¤‰æ›ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\n      let response;\n      try {\n        response = await chrome.runtime.sendMessage({\n          type: 'CONVERT_TO_YEN',\n          amount: currency.amount,\n          currency: currency.code,\n        });\n      } catch {\n        return;\n      }\n\n      if (!response || !response.success) {\n        return;\n      }\n\n      const { yen, rate, date } = response.data;\n\n      // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ã‚’å–å¾—\n      const tooltip = getTooltipElement();\n\n      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ›´æ–°\n      const originalEl = tooltip.querySelector('.cty-original');\n      const convertedEl = tooltip.querySelector('.cty-converted');\n      const rateInfoEl = tooltip.querySelector('.cty-rate-info');\n\n      if (originalEl) {\n        originalEl.textContent = currency.originalText;\n      }\n      if (convertedEl) {\n        convertedEl.textContent = formatYen(yen);\n      }\n      if (rateInfoEl) {\n        rateInfoEl.textContent = `${formatRate(rate, currency.code)}ï¼ˆ${date}ï¼‰`;\n      }\n\n      // ä½ç½®ã‚’è¨ˆç®—\n      positionTooltip(tooltip, x, y);\n\n      // è¡¨ç¤º\n      tooltip.style.display = 'block';\n      tooltip.classList.add('cty-tooltip-visible');\n    } catch {\n      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ä½•ã‚‚ã—ãªã„\n    }\n  }, 200);\n}\n\n/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®ä½ç½®ã‚’è¨ˆç®—\n */\nfunction positionTooltip(tooltip: HTMLElement, x: number, y: number): void {\n  const padding = 10;\n  const arrowSize = 8;\n\n  // ä¸€æ™‚çš„ã«è¡¨ç¤ºã—ã¦å¯¸æ³•ã‚’å–å¾—\n  tooltip.style.visibility = 'hidden';\n  tooltip.style.display = 'block';\n\n  const rect = tooltip.getBoundingClientRect();\n  const viewportWidth = window.innerWidth;\n  const viewportHeight = window.innerHeight;\n\n  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚«ãƒ¼ã‚½ãƒ«ã®ä¸Šã«è¡¨ç¤º\n  let left = x - rect.width / 2;\n  let top = y - rect.height - arrowSize - padding;\n  let arrowPosition: 'bottom' | 'top' = 'bottom';\n\n  // ç”»é¢ä¸Šéƒ¨ã«åã¾ã‚‰ãªã„å ´åˆã¯ä¸‹ã«è¡¨ç¤º\n  if (top < padding) {\n    top = y + arrowSize + padding;\n    arrowPosition = 'top';\n  }\n\n  // å·¦ç«¯ã®èª¿æ•´\n  if (left < padding) {\n    left = padding;\n  }\n\n  // å³ç«¯ã®èª¿æ•´\n  if (left + rect.width > viewportWidth - padding) {\n    left = viewportWidth - rect.width - padding;\n  }\n\n  // ä¸‹ç«¯ã®èª¿æ•´\n  if (top + rect.height > viewportHeight - padding) {\n    top = viewportHeight - rect.height - padding;\n  }\n\n  tooltip.style.left = `${left}px`;\n  tooltip.style.top = `${top}px`;\n  tooltip.style.visibility = 'visible';\n\n  // çŸ¢å°ã®ä½ç½®ã‚’æ›´æ–°\n  const arrow = tooltip.querySelector('.cty-tooltip-arrow') as HTMLElement;\n  if (arrow) {\n    arrow.classList.remove('cty-arrow-top', 'cty-arrow-bottom');\n    arrow.classList.add(`cty-arrow-${arrowPosition}`);\n\n    // çŸ¢å°ã®æ°´å¹³ä½ç½®ã‚’èª¿æ•´\n    const arrowLeft = Math.max(20, Math.min(x - left, rect.width - 20));\n    arrow.style.left = `${arrowLeft}px`;\n  }\n}\n\n/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º\n */\nexport function hideTooltip(): void {\n  // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢\n  if (showTimer) {\n    clearTimeout(showTimer);\n    showTimer = null;\n  }\n\n  // é…å»¶éè¡¨ç¤ºï¼ˆ100msï¼‰\n  hideTimer = window.setTimeout(() => {\n    const tooltip = document.getElementById(TOOLTIP_ID);\n    if (tooltip) {\n      tooltip.classList.remove('cty-tooltip-visible');\n      tooltip.style.display = 'none';\n    }\n    hideTimer = null;\n  }, 100);\n}\n\n/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®éè¡¨ç¤ºã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n */\nexport function cancelHideTooltip(): void {\n  if (hideTimer) {\n    clearTimeout(hideTimer);\n    hideTimer = null;\n  }\n}\n\n/**\n * ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ã‚’å‰Šé™¤ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ç”¨ï¼‰\n */\nexport function destroyTooltip(): void {\n  if (tooltipElement) {\n    tooltipElement.remove();\n    tooltipElement = null;\n  }\n  if (showTimer) {\n    clearTimeout(showTimer);\n    showTimer = null;\n  }\n  if (hideTimer) {\n    clearTimeout(hideTimer);\n    hideTimer = null;\n  }\n}\n","/**\n * ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ - ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ\n * ãƒã‚¦ã‚¹ãƒ›ãƒãƒ¼ã§é€šè²¨ã‚’æ¤œå‡ºã—ã€æ—¥æœ¬å††ã«å¤‰æ›ã—ã¦è¡¨ç¤º\n */\n\nimport './styles.css';\nimport { detectCurrencyAtPoint } from './currencyDetector';\nimport { showTooltip, hideTooltip, cancelHideTooltip, destroyTooltip } from './tooltip';\nimport type { ExtensionSettings } from '../types/currency';\n\n/** æ‹¡å¼µæ©Ÿèƒ½ã®æœ‰åŠ¹/ç„¡åŠ¹çŠ¶æ…‹ */\nlet isEnabled = true;\n\n/** æœ€å¾Œã«æ¤œå‡ºã—ãŸé€šè²¨æƒ…å ± */\nlet lastDetectedCurrency: ReturnType<typeof detectCurrencyAtPoint> = null;\n\n/** ãƒã‚¦ã‚¹ç§»å‹•ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã‚¿ã‚¤ãƒãƒ¼ */\nlet mouseMoveTimer: number | null = null;\n\n/** ãƒ‡ãƒã‚¦ãƒ³ã‚¹é–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰ */\nconst DEBOUNCE_DELAY = 50;\n\n/**\n * è¨­å®šã‚’å–å¾—ã—ã¦é©ç”¨\n */\nasync function loadSettings(): Promise<void> {\n  try {\n    const response = await chrome.runtime.sendMessage({ type: 'GET_SETTINGS' });\n    if (response.success) {\n      const settings = response.data as ExtensionSettings;\n      isEnabled = settings.enabled;\n      console.log('[Currency to Yen] è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', settings);\n    }\n  } catch (err) {\n    console.warn('[Currency to Yen] è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', err);\n  }\n}\n\n/**\n * ãƒã‚¦ã‚¹ç§»å‹•ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©\n */\nfunction handleMouseMove(event: MouseEvent): void {\n  if (!isEnabled) return;\n\n  // ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†\n  if (mouseMoveTimer) {\n    clearTimeout(mouseMoveTimer);\n  }\n\n  mouseMoveTimer = window.setTimeout(() => {\n    processMousePosition(event);\n    mouseMoveTimer = null;\n  }, DEBOUNCE_DELAY);\n}\n\n/**\n * ãƒã‚¦ã‚¹ä½ç½®ã‚’å‡¦ç†\n */\nfunction processMousePosition(event: MouseEvent): void {\n  const target = event.target as Element;\n\n  // è‡ªåˆ†è‡ªèº«ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¯ç„¡è¦–\n  if (target.closest('#currency-to-yen-tooltip')) {\n    cancelHideTooltip();\n    return;\n  }\n\n  // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‹ã‚‰é€šè²¨ã‚’æ¤œå‡º\n  const currency = detectCurrencyAtPoint(target, event.clientX, event.clientY);\n\n  if (currency) {\n    // å‰å›ã¨åŒã˜é€šè²¨ãªã‚‰ä½•ã‚‚ã—ãªã„\n    if (\n      lastDetectedCurrency &&\n      lastDetectedCurrency.originalText === currency.originalText &&\n      lastDetectedCurrency.startIndex === currency.startIndex\n    ) {\n      cancelHideTooltip();\n      return;\n    }\n\n    lastDetectedCurrency = currency;\n    showTooltip(currency, event.clientX, event.clientY);\n  } else {\n    // é€šè²¨ãŒãªã‘ã‚Œã°ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º\n    if (lastDetectedCurrency) {\n      lastDetectedCurrency = null;\n      hideTooltip();\n    }\n  }\n}\n\n/**\n * ãƒã‚¦ã‚¹ã‚¢ã‚¦ãƒˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©\n */\nfunction handleMouseOut(event: MouseEvent): void {\n  // é–¢é€£ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—å†…ãªã‚‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n  const relatedTarget = event.relatedTarget as Element;\n  if (relatedTarget?.closest?.('#currency-to-yen-tooltip')) {\n    return;\n  }\n\n  // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¤–ã«å‡ºãŸå ´åˆ\n  if (!relatedTarget || !document.body.contains(relatedTarget)) {\n    lastDetectedCurrency = null;\n    hideTooltip();\n  }\n}\n\n/**\n * è¨­å®šå¤‰æ›´ãƒªã‚¹ãƒŠãƒ¼\n */\nfunction setupSettingsListener(): void {\n  chrome.storage.onChanged.addListener((changes, areaName) => {\n    if (areaName === 'sync' && changes.settings) {\n      const newSettings = changes.settings.newValue as ExtensionSettings;\n      isEnabled = newSettings.enabled;\n      console.log('[Currency to Yen] è¨­å®šãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ:', newSettings);\n\n      if (!isEnabled) {\n        hideTooltip();\n      }\n    }\n  });\n}\n\n/**\n * ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š\n */\nfunction setupEventListeners(): void {\n  // ãƒã‚¦ã‚¹ç§»å‹•ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ‘ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã§è»½é‡åŒ–ï¼‰\n  document.addEventListener('mousemove', handleMouseMove, { passive: true });\n\n  // ãƒã‚¦ã‚¹ã‚¢ã‚¦ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ\n  document.addEventListener('mouseout', handleMouseOut, { passive: true });\n\n  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º\n  document.addEventListener('scroll', () => {\n    lastDetectedCurrency = null;\n    hideTooltip();\n  }, { passive: true });\n\n  // ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n  window.addEventListener('beforeunload', () => {\n    destroyTooltip();\n  });\n}\n\n/**\n * åˆæœŸåŒ–\n */\nasync function initialize(): Promise<void> {\n  // è¨­å®šã‚’èª­ã¿è¾¼ã¿ï¼ˆã‚¨ãƒ©ãƒ¼ãŒã‚ã£ã¦ã‚‚ç¶šè¡Œï¼‰\n  try {\n    await loadSettings();\n  } catch {\n    isEnabled = true; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹\n  }\n\n  // è¨­å®šå¤‰æ›´ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š\n  try {\n    setupSettingsListener();\n  } catch {\n    // è¨­å®šãƒªã‚¹ãƒŠãƒ¼ã®ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–\n  }\n\n  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š\n  setupEventListeners();\n}\n\n// åˆæœŸåŒ–ã‚’å®Ÿè¡Œ\ninitialize().catch(() => {\n  // ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ã¦ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯è¨­å®šã™ã‚‹\n  setupEventListeners();\n});\n"],"names":["SYMBOL_TO_CODE","$","parseAmount","amountStr","cleaned","trim","replace","amount","parseFloat","isNaN","CURRENCY_PATTERNS","pattern","getCode","match","prefix","toUpperCase","US","HK","AU","A","CA","C","SG","S","NT","getAmount","detectCurrencies","text","results","foundRanges","lastIndex","exec","code","startIndex","index","endIndex","length","some","range","start","end","push","originalText","sort","a","b","detectFromTargetElement","element","x","y","tagName","toLowerCase","includes","isCustomElement","textContent","innerText","ariaLabel","getAttribute","title","dataValue","maxLength","rect","getBoundingClientRect","maxWidth","width","height","left","right","top","bottom","currencies","isPointInTextRange","textNode","startOffset","endOffset","document","createRange","setStart","setEnd","padding","CURRENCY_NAMES","USD","EUR","GBP","CNY","KRW","AUD","CAD","CHF","HKD","SGD","TWD","THB","INR","PHP","MYR","JPY","TOOLTIP_ID","tooltipElement","showTimer","hideTimer","formatYen","Intl","NumberFormat","style","currency","maximumFractionDigits","format","Math","round","async","showTooltip","clearTimeout","window","setTimeout","response","chrome","runtime","sendMessage","type","success","yen","rate","date","data","tooltip","body","contains","createElement","id","className","innerHTML","display","appendChild","createTooltipElement","originalEl","querySelector","convertedEl","rateInfoEl","formatRate","visibility","viewportWidth","innerWidth","viewportHeight","innerHeight","arrowPosition","arrow","classList","remove","add","arrowLeft","max","min","positionTooltip","hideTooltip","getElementById","cancelHideTooltip","isEnabled","lastDetectedCurrency","mouseMoveTimer","handleMouseMove","event","target","closest","rangeResult","caretRangeFromPoint","startContainer","nodeType","Node","TEXT_NODE","offset","substring","relativeOffset","actualStart","actualEnd","detectFromCaretRange","elementResult","current","parentElement","depth","result","detectFromParentElements","detectCurrencyAtPoint","clientX","clientY","processMousePosition","handleMouseOut","relatedTarget","setupEventListeners","addEventListener","passive","settings","enabled","console","log","err","warn","loadSettings","storage","onChanged","addListener","changes","areaName","newSettings","newValue","initialize","catch"],"ignoreList":[],"sourceRoot":""}